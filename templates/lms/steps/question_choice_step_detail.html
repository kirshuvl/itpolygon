{% extends 'lms/steps/detail.html' %}
{% block page_title %}{{ page_title }}{% endblock %}
{% block step_body %}
<div class="card-body">
    <div class="card">
        <div class="card-header bg-transparent px-3">
            Всего попыток: {% if step.num_attempts == -1 %}не ограничено{% else %} {{ step.num_attempts }}{% endif %}
        </div>
        <div class="card-body pb-0">
            {{ step.description|safe }}
        </div>
    </div>
    {% if user|user_has_right_answer:attempts %}
    <div class="card mt-2">
        <div class="card-body text-center text-success">
            Уже есть правильный ответ
        </div>
    </div>
    {% elif step.num_attempts > attempts.count %}
    <div class="card mt-2">
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <div class="btn-group col-12">{% for radio in form.user_answer %}{{ radio.tag }}
                    <label class="btn btn-outline-primary col-12 p-2" for="{{ radio.id_for_label  }}">{{ radio.choice_label }}</label>
                    {% endfor %}
                    <button type="submit" class="btn btn-outline-secondary p-2">Отправить</button>
                </div>
            </form>
        </div>
    </div>
    {% else %}
    <div class="card mt-2">
        <div class="card-body text-center text-danger">
            Вы исчерпали все попытки
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
{% block under_content %}{% if attempts %}
<div class="card shadow">
    <div class="card-header bg-transparent p-3">
        <h4 class="m-0">
            <i class="bi bi-ui-checks-grid me-3"></i>Ваши попытки
        </h4>
    </div>
    <div class="card-body">
        <div class="card mb-1">
            <div class="card-body">
                <div class="row align-items-center small">
                    <div class="col-1 text-center border-end">
                        ID
                    </div>
                    <div class="col-4 text-center border-end">
                        Время ответа
                    </div>
                    <div class="col-4 text-center border-end">
                        Ответ
                    </div>
                    <div class="col-3 text-center border-end">
                        Результат
                    </div>
                </div>
            </div>
        </div>
        {% for attempt in attempts %}
        <div class="card {% if not forloop.last %}mb-1{% endif %}">
            <div class="card-body">
                <div class="row align-items-center small">
                    <div class="col-1 text-center border-end">
                        {{ attempt.pk }}
                    </div>
                    <div class="col-4 text-center border-end">
                        {{ attempt.date_create|date:'d.m.Y H:i:s' }}
                    </div>
                    <div class="col-4 text-center border-end">
                        {{ attempt.user_answer }}
                    </div>
                    <div class="col-3 text-center border-end">
                        {% if attempt.is_correct %}
                        <span class="badge bg-success opacity-50 p-2 rounded"><i class="bi bi-check-square"></i></span>
                        {% else %}
                        <span class="badge bg-danger opacity-50 p-2 rounded"><i class="bi bi-x-square"></i></span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}{% endblock %}